<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é æ¸¬é–±è®€ç­–ç•¥ç·´ç¿’å™¨ (AI å¢å¼·ç‰ˆ)</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg-color: #f0f4f8;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --sparkle: #8b5cf6;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-8 { margin-bottom: 2rem; }
        .text-center { text-align: center; }
        .font-bold { font-weight: bold; }
        .w-full { width: 100%; }

        /* Typography */
        h1 { font-size: 2rem; color: #1e293b; margin-bottom: 0.5rem; }
        h2 { font-size: 1.5rem; color: #334155; }
        h3 { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; }
        p { margin-bottom: 1rem; }

        /* Components */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: transform 0.2s;
            border: 1px solid #e2e8f0;
            position: relative; /* For delete button positioning */
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: #cbd5e1;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s;
            text-decoration: none;
            gap: 8px;
        }

        .btn:hover { background-color: var(--primary-hover); }
        .btn:disabled { background-color: #cbd5e1; cursor: not-allowed; }
        
        .btn-secondary {
            background-color: #64748b;
        }
        .btn-secondary:hover { background-color: #475569; }

        .btn-success {
            background-color: #059669;
        }
        .btn-success:hover { background-color: #047857; }

        .btn-ai {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
        }
        .btn-ai:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .btn-delete {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #fee2e2;
            color: var(--danger);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0; /* Hidden by default */
        }
        .card:hover .btn-delete { opacity: 1; }
        .btn-delete:hover {
            background-color: #fee2e2;
            transform: scale(1.1);
        }

        .input-field {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .input-field:focus { border-color: var(--primary); }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .tag-entry { background-color: #dcfce7; color: #166534; }
        .tag-med { background-color: #dbeafe; color: #1e40af; }
        .tag-adv { background-color: #f3e8ff; color: #6b21a8; }
        .tag-ai { background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%); color: #6b21a8; border: 1px solid #d8b4fe; }

        .progress-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 999px;
            height: 0.5rem;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .svg-icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        /* Reading View specific */
        .reading-text {
            font-size: 1.15rem;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #334155;
            padding: 2rem;
            border-left: 6px solid var(--primary);
            background: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .prediction-box {
            background-color: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 12px;
            padding: 1.5rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* Loading Spinner */
        .spinner {
            animation: rotate 2s linear infinite;
            width: 20px;
            height: 20px;
        }
        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .ai-feedback-box {
            background: linear-gradient(to right, #f5f3ff, #fff);
            border: 1px solid #ddd6fe;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
        }
        .ai-feedback-box::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 4px; height: 100%;
            background: #8b5cf6;
        }

        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white; color: black; }
            .container { padding: 0; max-width: 100%; }
            .card, .reading-text, .prediction-box, .ai-feedback-box {
                box-shadow: none;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
            .reading-text { border-left: 4px solid #000; padding: 1rem; }
            h1 { font-size: 1.8rem; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
            .print-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        }
    </style>
</head>
<body>

    <div id="app" class="container">
        <!-- Javascript will render content here -->
    </div>

    <!-- Modal Template (Hidden by default) -->
    <div id="aiModal" class="modal-overlay hidden">
        <div class="modal">
            <h2 class="mb-4 flex items-center gap-2" style="color:var(--sparkle)">
                <span class="svg-icon">âœ¨</span> AI æ•…äº‹ç”Ÿæˆå™¨
            </h2>
            <p>è«‹è¼¸å…¥æ‚¨æƒ³ç·´ç¿’çš„ä¸»é¡Œï¼ˆä¾‹å¦‚ï¼šæµ·åº•æ¢éšªã€æ·±å¤œçš„åšç‰©é¤¨ã€è¿·è·¯çš„æ©Ÿå™¨äººï¼‰ï¼š</p>
            <input type="text" id="aiTopicInput" class="input-field mb-4" placeholder="è¼¸å…¥ä¸»é¡Œ...">
            <div class="flex justify-between">
                <button class="btn btn-secondary" onclick="closeAiModal()">å–æ¶ˆ</button>
                <button class="btn btn-ai" onclick="generateStory()">
                    <span id="genBtnText">é–‹å§‹ç”Ÿæˆ</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const initialStories = [
            {
                id: 1,
                title: "L7 æ ¼ç†å¼—éŠè¨˜çš„è«·åˆºèˆ‡ç¿»è­¯",
                description: "é€™éƒ¨ç«¥è©±ç¶“å…¸å…¶å¯¦éš±è—è‘—è¾›è¾£çš„æ”¿æ²»è«·åˆºã€‚ç•¶ç¿»è­¯å‡ºéŒ¯æˆ–ç´°ç¯€è¢«æ”¹å‹•æ™‚ï¼Œå¯“æ„å°±æœƒç…™æ¶ˆé›²æ•£ã€‚",
                difficulty: "é€²éš",
                segments: [
                    {
                        text: "ç¶å¤«ç‰¹ã€Šæ ¼ç†å¼—éŠè¨˜ã€‹ï¼ˆèˆŠè­¯ã€Šæ ¼åˆ—ä½›éŠè¨˜ã€‹æˆ–ã€Šå¤§å°äººåœ‹éŠè¨˜ã€‹ï¼‰åœ¨ä¸­æ–‡ä¸–ç•Œè£¡å¹¾ä¹æ˜¯äººç›¡çš†çŸ¥çš„å…’ç«¥å¥‡å¹»æ–‡å­¸ï¼Œä½†åœ¨è‹±æ–‡ä¸–ç•Œè£¡å®ƒå…¶å¯¦æ˜¯ä¸€éƒ¨ç”¨ä¾†è«·åˆºäººæ€§ã€è‹±åœ‹æ™‚æ”¿èˆ‡æ¬Šè²´çš„ä½œå“ã€‚åŸæ›¸æœ‰å››å†Šï¼Œä½†è¨±å¤šä¸­è­¯æœ¬åªæœ‰ç¬¬ä¸€ã€äºŒå†Šçš„ã€Šå°äººåœ‹ã€‹ã€ã€Šå¤§äººåœ‹ã€‹ï¼Œä½¿äººç„¡æ³•çªºå…¶å…¨è²Œã€‚",
                        question: "æ—¢ç„¶æ˜¯é‡å°ã€Œè‹±åœ‹æ™‚æ”¿ã€çš„è«·åˆºä½œå“ï¼Œæ‚¨é æ¸¬ä½œè€…åœ¨æå¯«å°äººåœ‹çš„åœ‹ç‹èˆ‡å®˜å“¡æ™‚ï¼Œæœƒåˆ»æ„å®‰æ’ä»€éº¼æ¨£æ»‘ç¨½çš„èˆ‰å‹•ä¾†å½±å°„ç¾å¯¦ï¼Ÿ",
                        hint: "æ€è€ƒï¼šæ¬ŠåŠ›è€…é€šå¸¸å¾ˆæœ‰å¨åš´ï¼Œè‹¥è®“ä»–å€‘åšä¸€äº›å‘å¾®æˆ–å¥‡æ€ªçš„å‹•ä½œï¼Œæœƒæœ‰ä»€éº¼è«·åˆºæ•ˆæœï¼Ÿ"
                    },
                    {
                        text: "åœ¨åŸå§‹ç‰ˆæœ¬ä¸­ï¼Œå°äººåœ‹åœ‹ç‹å°‡ä¸‰ç¨®ä¸åŒé¡è‰²çš„ç´°çµ²ç·šï¼šè—ã€ç´…ã€ç¶ ï¼Œè³è³œçµ¦è¡¨æ¼”é¡ä¼¼å‡Œæ³¢èˆèˆæŠ€æœ€ä½³çš„ä¸‰å€‹äººã€‚å…¶å¯¦ä¸åŒé¡è‰²çš„çµ²ç·šï¼Œæ˜¯åˆ†åˆ¥å½±å°„ç•¶æ™‚ä¸‰ç¨®é ’äºˆçˆµå£«çš„å‹³ç« ï¼šè—è‰²ç¶¬å¸¶çš„å˜‰å¾·å‹³ç« ã€ç´…è‰²ç¶¬å¸¶çš„å·´æ–¯å‹³ç« ã€ç¶ è‰²ç¶¬å¸¶çš„è–Šå‹³ç« ã€‚",
                        question: "ä½œè€…ç‚ºä»€éº¼è¦ç”¨ã€Œå‡Œæ³¢èˆæŠ€ã€ä¾†æ±ºå®šèª°èƒ½ç²å¾—è±¡å¾µæ¦®è­½çš„çµ²ç·šï¼ˆå‹³ç« ï¼‰ï¼Ÿé€™åœ¨å½±å°„ç•¶æ™‚å®˜å“¡çš„ä»€éº¼ç‰¹è³ªï¼Ÿ",
                        hint: "æ€è€ƒï¼šè·³å‡Œæ³¢èˆéœ€è¦ç­‹éª¨æŸ”è»Ÿã€‚åœ¨å®˜å ´ä¸Šï¼Œã€ŒæŸ”è»Ÿã€çš„äººä»£è¡¨ä»€éº¼ï¼Ÿ"
                    },
                    {
                        text: "å› ç‚ºå‡Œæ³¢èˆé«˜æ‰‹çš„ç­‹éª¨è¦å¾ˆæŸ”è»Ÿï¼Œç¶å¤«ç‰¹ç”¨ä¾†å½±å°„æ²’æœ‰éª¨æ°£çš„äººæ‰èƒ½å¾—åˆ°å¯µæ„›ã€æˆç‚ºé«˜å®˜ã€‚ä½†ä¹Ÿå› ç‚ºæš—ç¤ºéæ–¼æ˜é¡¯ï¼Œå‡ºç‰ˆå•†æ“”å¿ƒæœƒå¾—ç½ªç•¶é“ï¼Œæ‰€ä»¥åœ¨å‡ºç‰ˆæ™‚å°‡çµ²ç·šçš„é¡è‰²æ”¹ç‚ºç´«ã€é»ƒã€ç™½ã€‚é¡è‰²ä¸€æ”¹ï¼Œå¯“æ„å°±ç…™æ¶ˆé›²æ•£ã€‚",
                        question: "é™¤äº†å…§å®¹çš„æ”¹å‹•ï¼Œæ–‡ç« æåˆ°ã€Œç¿»è­¯ã€ä¹Ÿæœƒé€ æˆå½±éŸ¿ã€‚å¦‚æœå°‡ä¸»è§’çš„é‡è¦å°ˆæ¥­èº«åˆ†è­¯éŒ¯ï¼Œæ‚¨é æ¸¬æœƒå°æ•…äº‹çš„é‚è¼¯ç”¢ç”Ÿä»€éº¼è¡æ“Šï¼Ÿ",
                        hint: "æ€è€ƒï¼šä¸»è§’åœ¨èˆªè¡Œä¸­è‹¥é‡åˆ°å‚·ç—…ï¼Œä»–çš„èº«åˆ†å¿…é ˆåˆç†æ‰èƒ½è§£æ±ºå•é¡Œã€‚"
                    },
                    {
                        text: "æ­¤å¤–ï¼Œæ—©æœŸçš„ä¸­æ–‡ç‰ˆæœ‰èª¤è­¯ä¹‹è™•ã€‚å¦‚åŸæ›¸ä¸­æ‡‰æŒ‡ã€Œé†«å­¸ã€ä¸€è©ï¼Œå»è¢«è­¯è€…ç¿»æˆã€Œæ ¼ç‰©å­¸ã€ã€‚æ‰€å­¸çš„å…§å®¹ä¸€è®Šï¼Œä¸»äººç¿èˆ¹é†«çš„èº«åˆ†ä¹Ÿå°±è®Šäº†ï¼Œåœ¨é•·é€”èˆªè¡Œä¸­è©²å¦‚ä½•ç™¼æ®æ‰€å­¸ä»¤äººæœ‰äº›å›°æƒ‘ã€‚ç”±æ­¤å¯è¦‹ï¼Œç¿»è­¯æ™‚è¢«èª¤è§£çš„å…§å®¹ï¼Œæœ‰æ™‚æœƒæœ‰æ¥µå¤§çš„å½±éŸ¿ã€‚",
                        question: "ç·´ç¿’çµæŸã€‚",
                        isEnd: true
                    }
                ]
            },
            {
                id: 2,
                title: "L8 æ„›ä¸å ¡çš„åœ–æ›¸é¤¨èˆ‡æ™‚é–“è¡¨",
                description: "é—œæ–¼ä¸€æ®µç•°é„‰æ±‚å­¸çš„è¨˜æ†¶ã€‚ç•¶ç”Ÿæ´»åªå‰©ä¸‹ä¸€æ¢é€šå¾€ç›®æ¨™çš„è·¯å¾‘æ™‚ï¼Œæˆ‘å€‘æœƒéŒ¯éä»€éº¼ï¼Ÿ",
                difficulty: "ä¸­ç­‰",
                segments: [
                    {
                        text: "æœ€è¿‘ï¼Œæˆ‘ç¶“å¸¸æƒ³èµ·æ„›ä¸å ¡ï¼Œå¯èƒ½æ˜¯å› ç‚ºå†¬å¤©å¿«åˆ°äº†å§ã€‚æ„›ä¸å ¡æ˜¯ä¸€å€‹å¾ˆå†·çš„åŸå¸‚ã€‚ç•¶æˆ‘æƒ³èµ·é€™å€‹åŸå¸‚çš„æ™‚å€™ï¼Œæˆ‘é€šå¸¸åªè¨˜å¾—å¾æˆ‘ä½çš„åœ°æ–¹èµ°åˆ°åœ–æ›¸é¤¨çš„è·¯ã€‚å…¶ä»–çš„åœ°æ–¹ï¼Œæˆ‘æœ‰æ™‚å€™é€£åå­—éƒ½è¨˜ä¸æ¸…äº†ã€‚æˆ‘åœ¨æ„›ä¸å ¡ä½äº†ä¸‰å¹´ï¼Œä½†é›¢é–‹å¾Œï¼Œæœ‰é—œå®ƒçš„è¨˜æ†¶å»æ¼¸æ¼¸æ¨¡ç³Šèµ·ä¾†ã€‚",
                        question: "ä½œè€…æåˆ°å°é€™åº§åŸå¸‚çš„è¨˜æ†¶åªå‰©ä¸‹ã€Œå»åœ–æ›¸é¤¨çš„è·¯ã€ï¼Œé€™å¯èƒ½åæ˜ äº†ä»–ç•¶æ™‚åœ¨ç•°é„‰çš„ç”Ÿæ´»é‡å¿ƒæ˜¯ä»€éº¼ï¼Ÿ",
                        hint: "æ€è€ƒï¼šä¸€å€‹ç•™å­¸ç”Ÿé™¤äº†åœ–æ›¸é¤¨ï¼Œé‚„æœ‰ä»€éº¼å¯èƒ½æ˜¯ä»–ç”Ÿæ´»çš„ä¸­å¿ƒï¼Ÿ"
                    },
                    {
                        text: "åœ¨æ„›ä¸å ¡æœŸé–“ï¼Œæˆ‘å¸¸å¸¸å¾å®¿èˆèµ°åˆ°åœ‹å®¶åœ–æ›¸é¤¨ã€‚æœ‰æ™‚å€™ï¼Œæˆ‘ä¹Ÿæœƒå»å¤§å­¸åœ–æ›¸é¤¨æˆ–ç¥å­¸é™¢åœ–æ›¸é¤¨æ‰¾è³‡æ–™ã€‚æˆ‘å–œæ­¡åœ–æ›¸é¤¨ï¼Œå°¤å…¶æ˜¯é‚£äº›è€èˆŠçš„åœ–æ›¸é¤¨ï¼Œå› ç‚ºé‚£è£¡æœ‰åšé‡çš„æœ¨é ­æ¡Œæ¤…ï¼Œæ°£æ°›å¾ˆå®‰éœï¼Œè€Œä¸”æœ‰ä¸€ç¨®å¤è€æ›¸æœ¬çš„å‘³é“ã€‚æˆ‘æœ€æœŸå¾…çš„æ™‚é–“æ˜¯ä¸‹åˆä¸‰å››é»ï¼Œé‚£æ™‚æˆ‘æœƒå»å°é¢çš„â€œå¤§è±¡å’–å•¡é¤¨â€å–å’–å•¡ï¼Œåƒæä»ç‰›è§’éºµåŒ…ï¼Œä¸¦çœ‹å ±ç´™ã€‚é‚£å®¶å’–å•¡é¤¨çš„çª—æˆ¶æ­£å¥½å°è‘—ä¸€åº§å¤è€çš„åŸå ¡ã€‚åœ¨æº«æš–ç†±é¬§çš„å’–å•¡é¤¨è£¡ï¼Œçœ‹è‘—é è™•å†·å³»çš„åŸå ¡ï¼Œçµ¦äº†æˆ‘ä¸€ç¨®ç‰¹åˆ¥çš„æ„Ÿå—ã€‚",
                        question: "åœ¨æº«æš–çš„å’–å•¡é¤¨çœ‹è‘—ã€Œå†·å³»ä¸”æ­·å²æ‚ ä¹…ã€çš„åŸå ¡ï¼Œä½œè€…èªªé€™æé†’ä»–ã€Œåœ¨é€™è£¡çš„æ™‚é–“åªæ˜¯çŸ­æš«çš„ä¸€å°éƒ¨åˆ†ã€ã€‚æ‚¨é æ¸¬ä½œè€…æ¥ä¸‹ä¾†æœƒå¦‚ä½•æè¿°ä»–å°ã€Œæ™‚é–“ã€çš„è¦åŠƒï¼Ÿ",
                        hint: "æ€è€ƒï¼šæ—¢ç„¶æ„Ÿè¦ºåˆ°æ™‚é–“çŸ­æš«ï¼Œäººé€šå¸¸æœƒç”¢ç”Ÿä¸€ç¨®ç·Šè¿«æ„Ÿæˆ–è¨ˆç•«æ„Ÿã€‚"
                    },
                    {
                        text: "ç•¶æˆ‘äºŒåå¤šæ­²çš„æ™‚å€™ï¼Œæˆ‘å»æ„›ä¸å ¡æ˜¯ç‚ºäº†å­¸ç¿’ã€‚æˆ‘çŸ¥é“æˆ‘ä¸æœƒæ°¸é ä½åœ¨é‚£è£¡ï¼Œå› ç‚ºæˆ‘åªæ˜¯ç‚ºäº†å®Œæˆå­¸æ¥­ï¼Œç„¶å¾Œè¦å›å®¶ã€‚é‚£æ™‚ï¼Œæˆ‘å¿ƒè£¡æœ‰ä¸€å¼µæ™‚é–“è¡¨ï¼Œæé†’æˆ‘ä»€éº¼æ™‚å€™è¦å®Œæˆå­¸æ¥­å›å®¶ã€‚é€™è®“æˆ‘çš„æ¯ä¸€å¤©éƒ½ä¸æ˜¯å–®ç¨çš„æ—¥å­ï¼Œè€Œæ˜¯ä¸€é€£ä¸²æœå‘æœªä¾†çš„æ—¥å­ã€‚",
                        question: "ä½œè€…æåˆ°ä»–ç•¶æ™‚æœ‰ä¸€å¼µã€Œæ™‚é–“è¡¨ã€ä¸”æ¥µåº¦å°ˆæ³¨æ–¼ç›®æ¨™ã€‚é€™è½èµ·ä¾†å¾ˆç©æ¥µï¼Œä½†æ‚¨é æ¸¬ä½œè€…é•·å¤§å¾Œæœƒå¦‚ä½•åæ€é€™æ®µã€Œå–®ä¸€å°ˆæ³¨ã€çš„æ—¥å­ï¼Ÿ",
                        hint: "æ€è€ƒï¼šéåº¦å°ˆæ³¨æ–¼å–®ä¸€ç›®æ¨™ï¼ˆå¦‚å­¸æ¥­ï¼‰ï¼Œå¯èƒ½æœƒè®“æˆ‘å€‘å¿½ç•¥å‘¨é­çš„ä»€éº¼äº‹ç‰©ï¼Ÿ"
                    },
                    {
                        text: "é‚£æ™‚å€™ï¼Œæˆ‘å€‘å°ˆæ³¨æ–¼ä¸€å€‹ç›®æ¨™â€”â€”å­¸ç¿’ã€‚æˆ‘å€‘ä¸çŸ¥é“é€™æ¨£åšæœƒè®“æˆ‘å€‘éŒ¯éè¨±å¤šå…¶ä»–çš„äº‹æƒ…ã€‚ç­‰æˆ‘å€‘é•·å¤§ä¸€äº›å¾Œï¼Œæ‰æœƒç™¼ç¾é€™æ¨£å–®ä¸€çš„å°ˆæ³¨æœƒè®“æˆ‘å€‘çš„è¦–é‡è®Šå¾—ç‹¹çª„ã€‚ç”±é€™å€‹æ•…äº‹æˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œåœ¨æœå‘ç›®æ¨™å‰é€²çš„åŒæ™‚ï¼Œä¹Ÿè¦å­¸æœƒæŠ¬é ­çœ‹çœ‹èº«é‚Šçš„é¢¨æ™¯ã€‚",
                        question: "ç·´ç¿’çµæŸã€‚",
                        isEnd: true
                    }
                ]
            },
            {
                id: 3,
                title: "L9 è¦ªè€•å„€å¼èˆ‡æ—©æœç§©åº",
                description: "å¤ä»£çš‡å¸çš„æ—¥å¸¸ç”Ÿæ´»ã€‚é€éè¦ªè€•çš„ã€Œè¡¨æ¼”ã€èˆ‡æ—©æœçš„ã€Œç´€å¾‹ã€ï¼Œçœ‹è¦‹æ”¿æ¬Šçš„è±¡å¾µæ„ç¾©ã€‚",
                difficulty: "ä¸­ç­‰",
                segments: [
                    {
                        text: "åœ¨å¤ä»£ï¼Œçš‡å¸æ˜¯å…¨åœ‹æœ€é«˜çš„é ˜å°äººï¼Œä»–çš„å¾ˆå¤šè¡Œå‹•éƒ½æœ‰ç‰¹åˆ¥çš„è±¡å¾µæ„ç¾©ã€‚æ¯å¹´ï¼Œçš‡å¸æœƒåœ¨å…ˆè¾²å£‡é™„è¿‘é€²è¡Œä¸€å€‹å«ã€Œè¦ªè€•ã€çš„æ´»å‹•ï¼Œé€™æœ‰é»åƒæ˜¯ä¸€å ´è¡¨æ¼”ã€‚åœ¨é€™å€‹æ´»å‹•é–‹å§‹å‰ï¼Œæ”¿åºœæœƒæ‰¾ä¸€äº›å°ˆæ¥­çš„æ¼”å“¡ä¾†å‡æ‰®æˆé¢¨ç¥ã€é›¨ç¥ç­‰ï¼Œé‚„æœƒé‚€è«‹å¾ˆå¤šåœ¨åœ°çš„è¾²æ°‘ä¾†åƒåŠ ï¼Œå°±åƒåœ¨æ¼”æˆ²ä¸€æ¨£ã€‚",
                        question: "æ—¢ç„¶èªªé€™æ˜¯ä¸€å ´ã€Œè¡¨æ¼”ã€ï¼Œä¸”é€£é¢¨ç¥ã€é›¨ç¥éƒ½æœ‰äººå‡æ‰®ï¼Œæ‚¨é æ¸¬çš‡å¸æ‰€ä½¿ç”¨çš„è€•åœ°å·¥å…·ï¼ˆçŠï¼‰ï¼Œæœƒæ˜¯æ™®é€šçš„è¾²å…·é‚„æ˜¯æœ‰ç‰¹æ®Šçš„è£é£¾ï¼Ÿ",
                        hint: "æ€è€ƒï¼šèº«ç‚ºæœ€é«˜é ˜å°äººçš„ã€Œè¡¨æ¼”ã€ï¼Œç´°ç¯€ä¸€å®šæœƒå±•ç¾å‡ºæ¬Šå¨æ„Ÿã€‚"
                    },
                    {
                        text: "æ´»å‹•é–‹å§‹æ™‚ï¼Œæœ‰å…©å€‹å®˜å“¡ç‰½è‘—ç‰›ï¼Œå…©ä½é•·è¼©æ‰¶è‘—çŠï¼Œå…¶ä»–è¢«æŒ‡å®šçš„è¾²æ°‘å‰‡å¸¶è‘—å„ç¨®è¾²å…·ï¼Œæ¨¡ä»¿è€•ä½œçš„æ¨£å­ã€‚æœ‰äº›æ¼”å“¡é‚„æœƒè£æ‰®æˆæ‘è£¡çš„äººï¼Œå”±è‘—å¤ªå¹³çš„æ­Œã€‚çš‡å¸ç”¨çš„çŠå’Œåˆ¥äººçš„ä¸ä¸€æ¨£ï¼Œæ˜¯ç‰¹åˆ¥è¯éº—çš„é‡‘è‰²çŠï¼Œä¸Šé¢é‚„æœ‰é¾çš„é›•åˆ»ã€‚åœ¨å…©ä½é•·è¼©çš„å¹«å¿™ä¸‹ï¼Œçš‡å¸èµ°éç”°åœ°ä¸‰æ¬¡ï¼Œå°±å®Œæˆäº†ã€Œè¦ªè€•ã€çš„å„€å¼ã€‚",
                        question: "çš‡å¸å®Œæˆé€™ä¸‰æ¬¡è±¡å¾µæ€§çš„è€•ä½œå¾Œï¼Œæ¥ä¸‹ä¾†æœƒç”±èª°ä¾†ç¹¼çºŒå®Œæˆæ’­ç¨®å·¥ä½œï¼Ÿæœ€å¾Œå¦‚ä½•å‘çš‡å¸è¡¨é”ç¥è³€ï¼Ÿ",
                        hint: "æ€è€ƒï¼šå„€å¼çš„å®Œæˆé€šå¸¸éœ€è¦åœ°æ–¹å®˜å“¡çš„é…åˆï¼Œæœ€å¾Œé‚„è¦æœ‰ä¸€ç¨®ã€Œå¤§è±æ”¶ã€çš„æ°›åœã€‚"
                    },
                    {
                        text: "å®Œæˆå¾Œï¼Œçš‡å¸åä¸‹ä¾†ï¼Œæ¬£è³å…¶ä»–å®˜å“¡æ¨¡ä»¿ä»–çš„å‹•ä½œã€‚åŒ—äº¬çš„æœ€é«˜åœ°æ–¹å®˜è² è²¬æ’­ç¨®ï¼Œä»–æ’­å®Œç¨®å¾Œï¼Œæœ‰äººæœƒç«¯ä¸Šè±¡å¾µå¥½æ”¶æˆçš„äº”ç©€ï¼Œå‘çš‡å¸ç»ä¸Šï¼Œè¡¨ç¤ºå› ç‚ºçš‡å¸çš„è¾›å‹å¸¶ä¾†äº†è±æ”¶ã€‚é€™æ™‚å€™ï¼Œå¤§å®¶éƒ½æœƒå‘çš‡å¸é«˜å–Šè¬æ­²ï¼Œç¥è³€ä»–ã€‚ä¸éï¼Œçš‡å¸çš„äº‹æƒ…ä¸éƒ½æ˜¯é€™éº¼è¼•é¬†å¥½ç©çš„ï¼Œåƒæ¯å¤©çš„ã€Œæ—©æœã€å°±å¾ˆåš´è‚…ã€‚",
                        question: "æ—©æœæ˜¯éå¸¸åš´è‚…çš„ã€‚æ‚¨é æ¸¬åœ¨æ—©æœçš„éšŠä¼ä¸­ï¼Œå®˜å“¡çš„è¡Œç‚ºæœƒå—åˆ°ä»€éº¼æ¨£çš„ç›£ç£ï¼Ÿ",
                        hint: "æ€è€ƒï¼šåœ¨çš‡å¸é¢å‰ï¼Œå’³å—½æˆ–ä¸ç¦®è²Œçš„è¡Œç‚ºæœƒè¢«å…è¨±å—ï¼Ÿ"
                    },
                    {
                        text: "é–€é–‹äº†ä¹‹å¾Œï¼Œå¤§å®¶æœƒç«™å¥½éšŠä¼ï¼Œæ–‡å®˜å’Œæ­¦å®˜å„è‡ªç«™åœ¨ä¸åŒçš„ä½ç½®ã€‚å¾¡å²æœƒè² è²¬é»åï¼Œä¸¦ä¸”è¨˜éŒ„é‚£äº›å’³å—½æˆ–æœ‰ä¸ç¦®è²Œè¡Œç‚ºçš„å®˜å“¡åå­—ã€‚æ¥è‘—çš‡å¸ä¾†äº†ï¼Œæ‰€æœ‰å®˜å“¡éƒ½è¦å‘çš‡å¸è¡Œç¦®ã€‚ç„¶å¾Œï¼Œä¸€äº›é‡è¦çš„å®˜å“¡æœƒé€²å…¥å¤§æ®¿å ±å‘Šäº‹æƒ…ã€‚é€™äº›æ—©æœçš„æ´»å‹•å¤§ç´„æœƒåœ¨æ—¥å‡ºæ™‚é–‹å§‹ï¼Œä¸ä¹…å¾ŒçµæŸã€‚ç”±é€™ç¯‡æ–‡ç« å¯è¦‹ï¼Œå¤ä»£çš„å„€ç¯€æ˜¯ç‚ºäº†ç¶­æŒç§©åºèˆ‡çµ±æ²»çš„èŠåš´æ„Ÿã€‚",
                        question: "ç·´ç¿’çµæŸã€‚",
                        isEnd: true
                    }
                ]
            },
            {
                id: 4,
                title: "æ€’æµ·æ±‚ç”Ÿï¼šé¢¨æš´ä¸­çš„æ±ºç­–",
                description: "ä¸€è‰˜æ¼èˆ¹é­é‡ç©ºå‰é¢¨æš´ã€‚åœ¨èˆ¹èˆµå¤±éˆã€é€²æ°´è­¦å ±éŸ¿èµ·çš„çµ•å¢ƒä¸­ï¼Œèˆ¹é•·å¦‚ä½•åšå‡ºæ±ºå®šï¼Ÿ",
                difficulty: "ä¸­ç­‰",
                segments: [
                    {
                        text: "ä¸€è‰˜æ¼èˆ¹åœ¨é æ´‹ä½œæ¥­æ™‚ï¼Œçªç„¶é­é‡äº†ä¸€å ´å¾æœªé è­¦çš„å¼·çƒˆé¢¨æš´ã€‚èˆ¹é•·ææ˜ç¶“é©—è±å¯Œï¼Œç«‹åˆ»ä¸‹ä»¤æ”¶ç¶²ï¼Œä¸¦æŒ‡ç¤ºèˆ¹å“¡ç›¡å¿«å°‡èˆ¹éš»é§›å‘æœ€è¿‘çš„é¿é¢¨æ¸¯ã€‚ç„¶è€Œï¼Œé¢¨æµªä¹‹å¤§ï¼Œä½¿å¾—èˆ¹èº«åŠ‡çƒˆæ–æ™ƒï¼Œå„€è¡¨æ¿ä¸Šçš„æŒ‡é‡ç˜‹ç‹‚è·³å‹•ï¼Œé€šè¨Šè¨­å‚™ä¹Ÿå› æµªèŠ±æ‹æ‰“è€Œå¤±éˆã€‚ä»–å€‘è©¦åœ–æ”¹è®Šèˆªå‘ï¼Œä½†ç™¼ç¾èˆ¹èˆµä¼¼ä¹è¢«æŸç¨®æ±è¥¿å¡ä½äº†ï¼Œé›£ä»¥æ“æ§ã€‚å¤©ç©ºåœ¨å¹¾åˆ†é˜å…§è®Šå¾—æ¼†é»‘ä¸€ç‰‡ï¼Œè±†å¤§çš„é›¨é»å¤¾é›œè‘—å†°é›¹ç ¸äº†ä¸‹ä¾†ã€‚",
                        question: "èˆ¹èˆµå¤±éˆä¸”é€šè¨Šä¸­æ–·ï¼Œæ‚¨é æ¸¬èˆ¹é•·æ¥ä¸‹ä¾†æœƒæ¡å–ä»€éº¼ç·Šæ€¥æªæ–½ä¾†ç©©ä½èˆ¹éš»ï¼Ÿ",
                        hint: "æ€è€ƒï¼šå¦‚æœç„¡æ³•æ§åˆ¶æ–¹å‘ï¼Œé¦–è¦ä»»å‹™æ˜¯é¿å…èˆ¹éš»éš¨æ³¢é€æµã€‚"
                    },
                    {
                        text: "èˆ¹é•·ææ˜ç·Šå’¬ç‰™é—œï¼Œä»–ç«‹åˆ»æ„è­˜åˆ°ï¼Œåœ¨é€™æ¨£çš„é¢¨æµªä¸­å˜—è©¦ä¿®ç†èˆ¹èˆµæ¥µåº¦å±éšªã€‚ä»–é€éæ“´éŸ³å™¨å¼é“ï¼šã€Œæ‹‹éŒ¨ï¼æ‰€æœ‰äººéƒ½åˆ°èˆ¹è‰™ä¸‹å±¤ï¼Œç¹«å¥½å®‰å…¨å¸¶ï¼ã€å¤§å‰¯ç‹çŒ›è¿…é€Ÿè¡åˆ°èˆ¹é ­ï¼Œè²»åŠ›åœ°æ‹‰å‹•äº†é‡‹æ”¾éŒ¨ç´¢çš„ç·Šæ€¥æ‰‹æŸ„ã€‚å·¨å¤§çš„éµéŒ¨è½å…¥å¤§æµ·ï¼Œèˆ¹èº«å‚³ä¾†ä¸€è²åŠ‡çƒˆçš„éœ‡å‹•ï¼Œæ¼‚ç§»çš„é€Ÿåº¦ç•¥å¾®æ¸›ç·©ã€‚ç„¶è€Œï¼ŒéŒ¨ç´¢çš„é•·åº¦ä¼¼ä¹ä¸è¶³ä»¥è®“éŒ¨è§¸åŠç©©å®šçš„æ·±æµ·åº•éƒ¨ã€‚å°±åœ¨é€™æ™‚ï¼Œèˆ¹è‰™å…§çªç„¶éŸ¿èµ·ä¸€é™£å°–éŠ³çš„è­¦å ±è²ã€‚",
                        question: "éŒ¨ç´¢é•·åº¦ä¸è¶³ä¸”è­¦å ±è²éŸ¿èµ·ï¼Œæ‚¨é æ¸¬ç™¼ç”Ÿäº†ä»€éº¼æ–°çš„å±æ©Ÿï¼Ÿ",
                        hint: "æ€è€ƒï¼šè­¦å ±é€šå¸¸ä»£è¡¨å…§éƒ¨å—ææˆ–ç·Šæ€¥ç‹€æ³ã€‚"
                    },
                    {
                        text: "è­¦å ±ä¾†è‡ªèˆ¹è‰™åº•éƒ¨â€”â€”é€²æ°´è­¦å ±ï¼ææ˜è¿…é€Ÿåˆ¤æ–·å½¢å‹¢ï¼Œå°‡å°è¬›æ©Ÿå¡çµ¦å¤§å‰¯ï¼šã€Œç‹çŒ›ï¼Œä½ å¸¶å…©å€‹äººå»ä¿®ç†èˆ¹èˆµï¼Œè©¦åœ–ä¿æŒè¿é¢¨ã€‚å…¶ä»–äººè·Ÿæˆ‘ä¸‹åº•è‰™ï¼Œæº–å‚™å•Ÿå‹•æ‡‰æ€¥æ°´æ³µï¼ã€å°±åœ¨ä»–å€‘åˆ†é ­è¡Œå‹•æ™‚ï¼Œç‹çŒ›é©šæåœ°å–Šé“ï¼šã€Œèˆ¹é•·ï¼éŒ¨ç´¢å¿«æ–·äº†ï¼æˆ‘å€‘æ­£è¢«æ‹–å‘å‰æ–¹éœ§ä¸­çš„å·¨å¤§é»‘å½±ï¼Œé‚£çœ‹èµ·ä¾†æ˜¯å€‹å³¶ï¼ã€",
                        question: "é€²æ°´ã€éŒ¨ç´¢æ–·è£‚ã€å‰æ–¹æœ‰é»‘å½±ã€‚é€™æ˜¯æœ€å¾Œçš„æ±ºç­–æ™‚åˆ»ï¼Œæ‚¨é æ¸¬çµå±€æœƒå¦‚ä½•ï¼Ÿ",
                        hint: "æ€è€ƒï¼šåœ¨èˆ¹éš»å³å°‡æ²‰æ²’ä¸”ç„¡æ³•æ§åˆ¶çš„æƒ…æ³ä¸‹ï¼Œå”¯ä¸€çš„ç”Ÿå­˜æ©Ÿæœƒåœ¨å“ªè£¡ï¼Ÿ"
                    },
                    {
                        text: "ææ˜æ˜ç™½ä¸€åˆ‡éƒ½çµæŸäº†ï¼Œä¿®ç†å·²ç„¡æ„ç¾©ã€‚ä»–æŠ“èµ·å°è¬›æ©Ÿå¼é“ï¼šã€Œå…¨é€Ÿå‰é€²ï¼å°æº–é»‘å½±è¡ï¼æˆ‘å€‘è¦æ¶ç˜ï¼ã€åœ¨æœ€å¾Œçš„æŒ‡ä»¤ä¸‹ï¼Œèˆ¹éš»è—‰è‘—é¢¨æµªçŒ›çƒˆåœ°è¡å‘æµ·å²¸ç·šã€‚è½Ÿéš†ä¸€è²å·¨éŸ¿ï¼Œèˆ¹éš»å´ç¿»ä¸¦æ“±æ·ºåœ¨å²©çŸ³æµ·å²¸ä¸Šã€‚é›–ç„¶èˆ¹æ¯€äº†ï¼Œä½†åœ¨é»‘æš—ä¸­ï¼Œé™¸çºŒå‚³ä¾†äº†èˆ¹å“¡å€‘ç¢ºèªå½¼æ­¤å­˜æ´»çš„å‘¼å–Šè²ã€‚",
                        question: "ç·´ç¿’çµæŸã€‚",
                        isEnd: true
                    }
                ]
            },
            {
                id: 5,
                title: "é°»é­šæ•ˆæ‡‰ï¼šå°æ‰‹çš„åƒ¹å€¼",
                description: "ç‚ºä»€éº¼æœ‰çš„æ¼æ°‘èƒ½è®“é°»é­šæ´»è‘—å›æ¸¯ï¼Ÿä¸€å€‹é—œæ–¼ç«¶çˆ­ã€å±æ©Ÿæ„Ÿèˆ‡ç”Ÿå‘½åŠ›çš„ç¶“å…¸å¯“è¨€ã€‚",
                difficulty: "å…¥é–€",
                segments: [
                    {
                        text: "å› ç‚ºæœ‰å°æ‰‹å­˜åœ¨ï¼Œæ—¥æœ¬çš„åŒ—æµ·é“å‡ºç”¢ä¸€ç¨®å‘³é“çå¥‡çš„é°»é­šï¼Œæµ·é‚Šæ¼æ‘çš„è¨±å¤šæ¼æ°‘éƒ½ä»¥æ•æ’ˆé°»é­šç‚ºç”Ÿã€‚é°»é­šçš„ç”Ÿå‘½éå¸¸è„†å¼±ï¼Œåªè¦ä¸€é›¢é–‹æ·±æµ·å€ï¼Œè¦ä¸äº†åŠå¤©å°±æœƒå…¨éƒ¨æ­»äº¡ã€‚å¥‡æ€ªçš„æ˜¯æœ‰ä¸€ä½è€æ¼æ°‘å¤©å¤©å‡ºæµ·æ•æ’ˆé°»é­šï¼Œè¿”å›å²¸é‚Šå¾Œï¼Œä»–çš„é°»é­šç¸½æ˜¯æ´»è¹¦äº‚è·³çš„ã€‚è€Œå…¶ä»–å¹¾å®¶æ¼æˆ¶ï¼Œå›æ¸¯å¾Œé°»é­šå…¨éƒ½æ˜¯æ­»çš„ã€‚",
                        question: "ç‚ºä»€éº¼åªæœ‰é€™ä½è€æ¼æ°‘çš„é°»é­šèƒ½æ´»ä¸‹ä¾†ï¼Ÿè«‹é æ¸¬ä»–çš„ç¥•è¨£å¯èƒ½èˆ‡ä»€éº¼æœ‰é—œï¼Ÿ",
                        hint: "æ€è€ƒï¼šæ¨™é¡Œæ˜¯ã€Œå› ç‚ºæœ‰å°æ‰‹å­˜åœ¨ã€ã€‚"
                    },
                    {
                        text: "åŸä¾†ï¼Œè€æ¼æ°‘ä½¿é°»é­šä¸æ­»çš„ç§˜è¨£ï¼Œå°±æ˜¯åœ¨æ•´å€‰çš„é°»é­šä¸­ï¼Œæ”¾é€²å¹¾æ¢å«ç‹—é­šçš„é›œé­šã€‚é°»é­šèˆ‡ç‹—é­šéä½†ä¸æ˜¯åŒé¡ï¼Œé‚„æ˜¯å‡ºåã€Œå°é ­ã€ã€‚å¹¾æ¢å‹¢å–®åŠ›è–„çš„ç‹—é­šé‡åˆ°æˆå€‰çš„å°æ‰‹ï¼Œä¾¿é©šæ…Œåœ°åœ¨é°»é­šå †è£¡å››è™•äº‚ç«„ï¼Œé€™æ¨£ä¸€ä¾†ï¼Œåè€Œå€’æŠŠæ»¿æ»¿ä¸€èˆ¹å€‰æ­»æ°£æ²‰æ²‰çš„é°»é­šå…¨çµ¦æ“Šæ´»äº†ã€‚",
                        question: "ä½œè€…è¬›è¿°é€™å€‹æ•…äº‹æ˜¯ç‚ºäº†å¼•å‡ºä»€éº¼æ¨£çš„äººç”Ÿæˆ–ç¤¾æœƒé“ç†ï¼Ÿè«‹é æ¸¬æ–‡ç« æ¥ä¸‹ä¾†çš„è«–è¿°æ–¹å‘ã€‚",
                        hint: "æ€è€ƒï¼šå°‡ã€Œé°»é­šèˆ‡ç‹—é­šã€çš„ç«¶çˆ­é—œä¿‚æ‡‰ç”¨åˆ°äººé¡ç¤¾æœƒã€‚"
                    },
                    {
                        text: "ä¸€ç¨®å‹•ç‰©å¦‚æœæ²’æœ‰å°æ‰‹ï¼Œå°±æœƒè®Šå¾—æ­»æ°£æ²‰æ²‰ã€‚åŒæ¨£çš„ï¼Œä¸€å€‹äººå¦‚æœæ²’æœ‰å°æ‰‹ï¼Œé‚£ä»–å°±æœƒç”˜æ–¼å¹³åº¸ã€‚æœ‰äº†å°æ‰‹ï¼Œæ‰æœ‰å±æ©Ÿæ„Ÿï¼Œæ‰æœƒæœ‰ç«¶çˆ­åŠ›ã€‚å–„å¾…ä½ çš„å°æ‰‹å§ï¼Œå› ç‚ºä»–çš„å­˜åœ¨ï¼Œä½ æ‰æœƒæ°¸é æ˜¯ä¸€æ¢é®®æ´»çš„ã€Œé°»é­šã€ã€‚",
                        question: "ç·´ç¿’çµæŸã€‚",
                        isEnd: true
                    }
                ]
            }
        ];

        // --- SVGs ---
        const svgs = {
            brain: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M12 4.5a2.5 2.5 0 0 0-4.96-.46 2.5 2.5 0 0 0-1.98 3 2.5 2.5 0 0 0-1.32 3 2.5 2.5 0 0 0 .38 2.7 2.5 2.5 0 0 0-1.62 3 2.5 2.5 0 0 0 2.7 2.2c.4 0 .77-.13 1.1-.34A2.5 2.5 0 0 0 12 19.5a2.5 2.5 0 0 0 5.7 0 2.5 2.5 0 0 0 5.7-1.84 2.5 2.5 0 0 0 1.1.34 2.5 2.5 0 0 0 2.7-2.2 2.5 2.5 0 0 0-1.62-3 2.5 2.5 0 0 0 .38-2.7 2.5 2.5 0 0 0-1.32-3 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 12 4.5Z"/><path d="M12 10v4"/></svg>`,
            book: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>`,
            arrowRight: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            user: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
            bulb: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5a6 6 0 0 0-11 0c0 1.5.5 2.5 1.5 3.5.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`,
            refresh: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>`,
            print: `<svg class="svg-icon" viewBox="0 0 24 24"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>`,
            check: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            sparkle: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>`,
            key: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>`,
            star: `<svg class="svg-icon" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
            trash: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>`
        };

        // --- STORAGE HELPERS ---
        const STORAGE_KEY_STORIES = 'prediction_app_custom_stories';

        function getStoredStories() {
            try {
                return JSON.parse(localStorage.getItem(STORAGE_KEY_STORIES) || '[]');
            } catch {
                return [];
            }
        }

        function saveStoredStories(stories) {
            localStorage.setItem(STORAGE_KEY_STORIES, JSON.stringify(stories));
        }

        // --- STATE & APP LOGIC ---
        const appState = {
            currentView: 'home',
            studentName: '',
            apiKey: '',
            selectedStory: null,
            segmentIndex: 0,
            userInput: '',
            history: [],
            // Initialize with saved stories merged with built-in ones
            stories: [...getStoredStories(), ...initialStories],
            aiFeedback: null
        };

        const appDiv = document.getElementById('app');

        function render() {
            appDiv.innerHTML = '';
            
            if (appState.currentView === 'home') {
                renderHome();
            } else if (appState.currentView === 'reading') {
                renderReading();
            } else if (appState.currentView === 'summary') {
                renderSummary();
            }
        }

        // --- GEMINI API HELPERS ---
        async function callGeminiAPI(systemPrompt, userPrompt, jsonMode = false) {
            if (!appState.apiKey) {
                alert("è«‹å…ˆåœ¨é¦–é è¼¸å…¥æ‚¨çš„ Gemini API Keyï¼");
                throw new Error("No API Key");
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${appState.apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: userPrompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            if (jsonMode) {
                payload.generationConfig = { responseMimeType: "application/json" };
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Call Failed:", error);
                alert("AI å‘¼å«å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¶²è·¯é€£ç·šã€‚");
                throw error;
            }
        }

        // --- AI ACTIONS ---
        function openAiModal() {
            document.getElementById('aiModal').classList.remove('hidden');
        }

        function closeAiModal() {
            document.getElementById('aiModal').classList.add('hidden');
        }

        async function generateStory() {
            const topic = document.getElementById('aiTopicInput').value.trim();
            if (!topic) return alert("è«‹è¼¸å…¥ä¸»é¡Œï¼");

            const btn = document.querySelector('#aiModal .btn-ai');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<div class="spinner"></div> ç”Ÿæˆä¸­...`;
            btn.disabled = true;

            const systemPrompt = `ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„é–±è®€æ•™è‚²å°ˆå®¶ï¼Œè«‹ç‚ºå­¸ç”Ÿæ’°å¯«ä¸€ç¯‡é—œæ–¼ã€Œ${topic}ã€çš„ç¹é«”ä¸­æ–‡é æ¸¬é–±è®€ç·´ç¿’æ•…äº‹ã€‚
            æ•…äº‹çµæ§‹è¦æ±‚ï¼š
            1. æ¨™é¡Œ (title)ï¼šå¸å¼•äººçš„æ¨™é¡Œã€‚
            2. æè¿° (description)ï¼šç°¡çŸ­çš„æ•…äº‹å¤§ç¶±ã€‚
            3. æ®µè½ (segments)ï¼šå°‡æ•…äº‹åˆ†ç‚º 3-4 å€‹æ®µè½ã€‚
               - å‰é¢çš„æ®µè½ (isEnd: false)ï¼šåŒ…å«ä¸€æ®µæ•…äº‹æ–‡å­— (text)ï¼Œä¸€å€‹å¼•å°å­¸ç”Ÿé æ¸¬å¾ŒçºŒç™¼å±•çš„å•é¡Œ (question)ï¼Œä»¥åŠä¸€å€‹æ€è€ƒæç¤º (hint)ã€‚
               - æœ€å¾Œä¸€å€‹æ®µè½ (isEnd: true)ï¼šåŒ…å«çµå±€æ–‡å­— (text)ï¼Œquestion è¨­ç‚º "ç·´ç¿’çµæŸ"ï¼Œhint è¨­ç‚º nullã€‚
            è«‹ç›´æ¥è¼¸å‡ºç´” JSON æ ¼å¼ã€‚`;

            try {
                const jsonStr = await callGeminiAPI(systemPrompt, `è«‹å‰µä½œé—œæ–¼ ${topic} çš„æ•…äº‹`, true);
                const newStory = JSON.parse(jsonStr);
                
                // Add ID and Difficulty
                newStory.id = Date.now();
                newStory.difficulty = "AI ç”Ÿæˆ";
                newStory.isCustom = true; // Flag for custom story
                
                // 1. Get current custom stories from storage
                const customStories = getStoredStories();
                // 2. Add new one to the front
                customStories.unshift(newStory);
                // 3. Save back to storage
                saveStoredStories(customStories);
                
                // 4. Update app state
                appState.stories = [...customStories, ...initialStories];
                
                closeAiModal();
                alert("æ•…äº‹ç”ŸæˆæˆåŠŸï¼å·²åŠ å…¥åˆ—è¡¨æœ€ä¸Šæ–¹ï¼Œä¸¦å·²è‡ªå‹•å„²å­˜ã€‚");
                render(); // Re-render home to show new story
            } catch (e) {
                // Error handled in helper
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        window.deleteStory = function(id, event) {
            event.stopPropagation(); // Prevent clicking card to start story
            if(confirm("ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™å€‹æ•…äº‹å—ï¼Ÿ")) {
                // 1. Update Storage
                const customStories = getStoredStories().filter(s => s.id !== id);
                saveStoredStories(customStories);
                
                // 2. Update State
                appState.stories = [...customStories, ...initialStories];
                render();
            }
        }

        async function getAIFeedback() {
            const btn = document.getElementById('feedbackBtn');
            const box = document.getElementById('aiFeedbackContent');
            
            btn.innerHTML = `<div class="spinner"></div> åˆ†æä¸­...`;
            btn.disabled = true;

            const systemPrompt = "ä½ æ˜¯ä¸€ä½è¦ªåˆ‡çš„é–±è®€è€å¸«ã€‚è«‹é–±è®€å­¸ç”Ÿçš„é æ¸¬ç´€éŒ„èˆ‡æ•…äº‹åŸæ–‡ï¼Œçµ¦äºˆç¹é«”ä¸­æ–‡çš„è©•èªã€‚æŒ‡å‡ºå­¸ç”Ÿé æ¸¬çš„åˆç†ä¹‹è™•ï¼Œä»¥åŠå¯ä»¥æ”¹é€²çš„æ€è€ƒæ–¹å‘ã€‚èªæ°£è¦é¼“å‹µä¸”å…·å•Ÿç™¼æ€§ã€‚è«‹ä½¿ç”¨ HTML æ ¼å¼è¼¸å‡º (ä½¿ç”¨ <p>, <ul>, <li>, <strong> ç­‰æ¨™ç±¤)ã€‚";
            
            let userContent = `æ•…äº‹æ¨™é¡Œï¼š${appState.selectedStory.title}\n\n`;
            appState.history.forEach((h, i) => {
                userContent += `æ®µè½ ${i+1} åŸæ–‡ï¼š${h.text}\n`;
                userContent += `å¼•å°å•é¡Œï¼š${h.question}\n`;
                userContent += `å­¸ç”Ÿé æ¸¬ï¼š${h.prediction}\n\n`;
            });
            userContent += `çµå±€ï¼š${appState.selectedStory.segments[appState.selectedStory.segments.length - 1].text}`;

            try {
                const feedbackHtml = await callGeminiAPI(systemPrompt, userContent, false);
                appState.aiFeedback = feedbackHtml;
                box.innerHTML = feedbackHtml;
                document.getElementById('aiFeedbackContainer').classList.remove('hidden');
                btn.style.display = 'none'; // Hide button after success
            } catch (e) {
                btn.innerHTML = `${svgs.sparkle} å–å¾— AI è€å¸«é»è©•`;
                btn.disabled = false;
            }
        }

        // --- HOME VIEW ---
        function renderHome() {
            const header = document.createElement('header');
            header.className = 'text-center mb-8';
            header.innerHTML = `
                <h1 class="font-bold flex justify-center items-center gap-2">
                    ${svgs.brain} é æ¸¬é–±è®€ç­–ç•¥ç·´ç¿’å™¨
                </h1>
                <p style="color:var(--text-sub)">é›¢ç·šç‰ˆ - éš¨æ™‚éš¨åœ°é›éŠé–±è®€æ€è€ƒåŠ› (AI åŠŸèƒ½éœ€é€£ç¶²)</p>
            `;

            const settingsCard = document.createElement('div');
            settingsCard.className = 'card mb-8';
            settingsCard.style.maxWidth = '600px';
            settingsCard.style.margin = '0 auto 2rem auto';
            settingsCard.innerHTML = `
                <div class="flex flex-col gap-4">
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:bold; display:flex; gap:0.5rem; align-items:center;">
                            ${svgs.user} å­¸ç”Ÿå§“å
                        </label>
                        <input type="text" id="studentNameInput" class="input-field" placeholder="è«‹è¼¸å…¥å§“å..." value="${appState.studentName}">
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:bold; display:flex; gap:0.5rem; align-items:center;">
                            ${svgs.key} Gemini API Key <span style="font-size:0.8rem; color:var(--text-sub); font-weight:normal;">(ä½¿ç”¨ AI åŠŸèƒ½å¿…å¡«)</span>
                        </label>
                        <input type="password" id="apiKeyInput" class="input-field" placeholder="è²¼ä¸Šæ‚¨çš„ API Key..." value="${appState.apiKey}">
                    </div>
                </div>
            `;

            const actionArea = document.createElement('div');
            actionArea.className = 'flex justify-center mb-8';
            actionArea.innerHTML = `
                <button class="btn btn-ai" onclick="openAiModal()">
                    ${svgs.sparkle} AI ç”Ÿæˆæ–°æ•…äº‹
                </button>
            `;

            const grid = document.createElement('div');
            grid.className = 'grid-layout';

            appState.stories.forEach(story => {
                const card = document.createElement('div');
                card.className = 'card flex flex-col justify-between';
                
                let tagClass = 'tag-med';
                if(story.difficulty === 'å…¥é–€') tagClass = 'tag-entry';
                if(story.difficulty === 'é€²éš') tagClass = 'tag-adv';
                if(story.difficulty === 'AI ç”Ÿæˆ') tagClass = 'tag-ai';

                const isCustom = story.isCustom || story.difficulty === 'AI ç”Ÿæˆ';

                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <span class="tag ${tagClass}">${story.difficulty}</span>
                            ${svgs.book}
                        </div>
                        <h3>${story.title}</h3>
                        <p style="color:var(--text-sub); font-size:0.95rem;">${story.description}</p>
                    </div>
                    <button class="btn w-full" onclick="startStory(${story.id})">
                        é–‹å§‹ç·´ç¿’ ${svgs.arrowRight}
                    </button>
                    ${isCustom ? `<button class="btn-delete" onclick="deleteStory(${story.id}, event)" title="åˆªé™¤æ­¤æ•…äº‹">${svgs.trash}</button>` : ''}
                `;
                grid.appendChild(card);
            });

            appDiv.appendChild(header);
            appDiv.appendChild(settingsCard);
            appDiv.appendChild(actionArea);
            appDiv.appendChild(grid);

            // Listen to input changes
            document.getElementById('studentNameInput').addEventListener('input', (e) => {
                appState.studentName = e.target.value;
            });
            document.getElementById('apiKeyInput').addEventListener('input', (e) => {
                appState.apiKey = e.target.value;
            });
        }

        // --- READING VIEW ---
        function renderReading() {
            const segment = appState.selectedStory.segments[appState.segmentIndex];
            const total = appState.selectedStory.segments.length - 1;
            const progress = ((appState.segmentIndex + 1) / total) * 100;

            const header = document.createElement('div');
            header.className = 'flex justify-between items-center mb-4';
            header.innerHTML = `
                <button class="btn btn-secondary" style="padding:0.5rem 1rem; font-size:0.9rem;" onclick="goHome()">
                    ${svgs.refresh} é€€å‡º
                </button>
                <div style="font-weight:600; color:var(--text-sub)">
                    é€²åº¦ï¼š${appState.segmentIndex + 1} / ${total}
                </div>
            `;

            const progressBar = document.createElement('div');
            progressBar.className = 'progress-container';
            progressBar.innerHTML = `<div class="progress-bar" style="width: ${Math.min(progress, 100)}%"></div>`;

            const textCard = document.createElement('div');
            textCard.className = 'reading-text';
            textCard.textContent = segment.text;

            const interactionArea = document.createElement('div');
            
            if (!segment.isEnd) {
                interactionArea.className = 'prediction-box';
                interactionArea.innerHTML = `
                    <div class="flex items-center gap-2 mb-4" style="color:var(--primary); font-weight:bold;">
                        ${svgs.bulb} <h3>é æ¸¬æå•</h3>
                    </div>
                    <p style="font-weight:600; margin-bottom:0.5rem;">${segment.question}</p>
                    <p style="font-size:0.9rem; color:var(--text-sub); font-style:italic; margin-bottom:1rem;">æç¤ºï¼š${segment.hint}</p>
                    <textarea id="userPrediction" class="input-field" style="min-height:120px; margin-bottom:1rem;" placeholder="æˆ‘é æ¸¬æ¥ä¸‹ä¾†..."></textarea>
                    <div class="flex" style="justify-content:flex-end;">
                        <button class="btn" onclick="submitPrediction()">ç¢ºèªä¸¦ç¹¼çºŒ ${svgs.arrowRight}</button>
                    </div>
                `;
            } else {
                interactionArea.className = 'text-center';
                interactionArea.style.marginTop = '2rem';
                interactionArea.innerHTML = `
                    <h3 style="color:#059669; margin-bottom:1rem;">ğŸ‰ ç·´ç¿’å®Œæˆï¼</h3>
                    <button class="btn btn-success" onclick="finishStory()">æŸ¥çœ‹å­¸ç¿’ç´€éŒ„ ${svgs.check}</button>
                `;
            }

            appDiv.appendChild(header);
            appDiv.appendChild(progressBar);
            appDiv.appendChild(textCard);
            appDiv.appendChild(interactionArea);
        }

        // --- SUMMARY VIEW ---
        function renderSummary() {
            const dateStr = new Date().toLocaleDateString();

            const container = document.createElement('div');
            
            // Non-printable Action Bar
            const actionBar = document.createElement('div');
            actionBar.className = 'flex justify-between items-center mb-8 no-print';
            actionBar.innerHTML = `
                <h2 style="margin:0;">å­¸ç¿’ç´€éŒ„å¡</h2>
                <div class="flex gap-2">
                    <button class="btn btn-success" onclick="window.print()">
                        ${svgs.print} åˆ—å° / å­˜ç‚º PDF
                    </button>
                    <button class="btn btn-secondary" onclick="goHome()">
                        è¿”å›é¦–é 
                    </button>
                </div>
            `;

            // Printable Report Area
            const report = document.createElement('div');
            report.className = 'card';
            
            // Generate History HTML
            const historyHtml = appState.history.map((item, idx) => `
                <div style="padding-left:1.5rem; border-left:4px solid #e2e8f0;">
                    <div style="margin-bottom:1rem;">
                        <span style="background:#f1f5f9; font-size:0.75rem; font-weight:bold; padding:2px 8px; border-radius:4px; color:#64748b;">æ®µè½ ${idx + 1}</span>
                        <div style="background:#f8fafc; padding:1rem; border-radius:8px; margin-top:0.5rem; font-style:italic; border:1px solid #f1f5f9;">
                            ${item.text}
                        </div>
                    </div>
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                        <div style="background:#eef2ff; padding:1rem; border-radius:8px; border:1px solid #e0e7ff;">
                            <div style="font-size:0.8rem; font-weight:bold; color:#4338ca; margin-bottom:0.25rem;">å¼•å°å•é¡Œ</div>
                            <div>${item.question}</div>
                        </div>
                        <div style="background:#fff7ed; padding:1rem; border-radius:8px; border:1px solid #ffedd5;">
                            <div style="font-size:0.8rem; font-weight:bold; color:#c2410c; margin-bottom:0.25rem;">å­¸ç”Ÿé æ¸¬</div>
                            <div style="font-weight:bold; color:#1e293b;">${item.prediction}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            // AI Feedback Section (Initially hidden or populated if exists)
            const aiSectionHtml = `
                <div id="aiFeedbackContainer" class="no-print ${appState.aiFeedback ? '' : 'hidden'}">
                    <div class="ai-feedback-box">
                        <h4 style="color:#6d28d9; margin-bottom:1rem; display:flex; align-items:center; gap:0.5rem;">
                            ${svgs.star} AI è€å¸«é»è©•
                        </h4>
                        <div id="aiFeedbackContent" style="color:#4b5563;">
                            ${appState.aiFeedback || ''}
                        </div>
                    </div>
                </div>
                
                <div class="no-print text-center mt-8">
                    ${!appState.aiFeedback ? `
                        <button id="feedbackBtn" class="btn btn-ai" onclick="getAIFeedback()">
                            ${svgs.sparkle} å–å¾— AI è€å¸«é»è©•
                        </button>
                    ` : ''}
                </div>
            `;

            report.innerHTML = `
                <div class="print-header" style="border-bottom:2px solid var(--primary); padding-bottom:1rem; margin-bottom:2rem; display:flex; justify-content:space-between; align-items:flex-end;">
                    <div>
                        <h1 style="font-size:1.8rem; margin-bottom:0.5rem; color:var(--primary);">${appState.selectedStory.title}</h1>
                        <p style="margin:0; color:var(--text-sub); font-weight:bold;">é æ¸¬é–±è®€ç­–ç•¥ç·´ç¿’ç´€éŒ„</p>
                    </div>
                    <div style="text-align:right;">
                        <p style="font-size:0.9rem; color:var(--text-sub); font-weight:bold;">å­¸ç”Ÿå§“å</p>
                        <p style="font-size:1.5rem; font-weight:bold;">${appState.studentName}</p>
                        <p style="font-size:0.85rem; color:#94a3b8;">${dateStr}</p>
                    </div>
                </div>

                <div style="display:flex; flex-direction:column; gap:2rem;">
                    ${historyHtml}
                    
                    <div style="background:#1e293b; color:white; padding:1.5rem; border-radius:12px; margin-top:1rem; -webkit-print-color-adjust: exact; print-color-adjust: exact;">
                        <h4 style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem; color:#818cf8;">
                            ${svgs.book} çµå±€èˆ‡å•Ÿç¤º
                        </h4>
                        <p style="margin:0; font-size:1.1rem;">
                            ${appState.selectedStory.segments[appState.selectedStory.segments.length - 1].text}
                        </p>
                    </div>
                </div>

                ${aiSectionHtml}
                
                <div style="margin-top:3rem; text-align:center; font-size:0.8rem; color:#cbd5e1; border-top:1px solid #f1f5f9; padding-top:1rem;">
                    é æ¸¬é–±è®€ç­–ç•¥ç·´ç¿’å™¨ (AI å¢å¼·ç‰ˆ)
                </div>
            `;

            container.appendChild(actionBar);
            container.appendChild(report);
            appDiv.appendChild(container);
        }

        // --- ACTIONS ---

        window.startStory = function(id) {
            if (!appState.studentName.trim()) {
                alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„å§“åï¼Œä»¥ä¾¿åœ¨æœ€å¾Œç”¢ç”Ÿå­¸ç¿’ç´€éŒ„ã€‚");
                return;
            }
            const story = appState.stories.find(s => s.id === id);
            appState.selectedStory = story;
            appState.segmentIndex = 0;
            appState.history = [];
            appState.userInput = '';
            appState.aiFeedback = null; // Reset feedback for new session
            appState.currentView = 'reading';
            render();
        }

        window.submitPrediction = function() {
            const input = document.getElementById('userPrediction');
            const val = input.value.trim();
            if (!val) {
                alert("è«‹è¼¸å…¥æ‚¨çš„é æ¸¬ï¼");
                return;
            }

            const currentSeg = appState.selectedStory.segments[appState.segmentIndex];
            
            appState.history.push({
                text: currentSeg.text,
                question: currentSeg.question,
                prediction: val
            });

            // Next segment
            if (appState.segmentIndex < appState.selectedStory.segments.length - 1) {
                appState.segmentIndex++;
                render(); // Re-render reading view with next segment
            } else {
                // Should not happen based on logic but safe guard
                finishStory();
            }
        }

        window.finishStory = function() {
            appState.currentView = 'summary';
            render();
        }

        window.goHome = function() {
            if (confirm("ç¢ºå®šè¦è¿”å›é¦–é å—ï¼Ÿç›®å‰çš„é€²åº¦å°‡æœƒæ¶ˆå¤±ã€‚")) {
                appState.currentView = 'home';
                appState.selectedStory = null;
                appState.history = [];
                render();
            }
        }

        // Initial Render
        render();

    </script>
</body>
</html>